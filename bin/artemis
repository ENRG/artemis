#!/usr/bin/env node

var program = require('commander');
var server  = require('../');
var pkg     = require('../package.json');
var config  = require('../config');
var http    = require('http');

program
  .version(pkg.version)
  .option('-p, --port', 'Port to serve HTTP requests from')
  .parse(process.argv);

server.configure(function(){
  server.set('port', program.port || config.port);
});

db.connect({ connStr: config.db.connStr }, function(error){
  if (error) throw error;

  db.sync();
});

http.createServer(server).listen(server.get('port'), function(){
  console.log("Artemis listening on port " + server.get('port'));
});